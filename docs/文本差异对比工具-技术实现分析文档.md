# æ–‡æœ¬å·®å¼‚å¯¹æ¯”å·¥å…· - æŠ€æœ¯å®ç°åˆ†ææ–‡æ¡£

> **æ–‡æ¡£ç›®çš„**: æ·±å…¥åˆ†ææ–‡æœ¬å·®å¼‚å¯¹æ¯”å·¥å…·çš„æ ¸å¿ƒæŠ€æœ¯å®ç°æ€è·¯å’Œä»£ç æ¶æ„
> **æŠ€æœ¯æ ˆ**: Vue3 + TypeScript + diff-match-patch + UnoCSS + Element Plus
> **ç”Ÿæˆæ—¶é—´**: 2025-11-22
> **ç‰ˆæœ¬**: v1.0

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¶æ„æ¦‚è§ˆ](#é¡¹ç›®æ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒæŠ€æœ¯æ¨¡å—](#æ ¸å¿ƒæŠ€æœ¯æ¨¡å—)
3. [æ–‡æœ¬é¢„å¤„ç†æµç¨‹](#æ–‡æœ¬é¢„å¤„ç†æµç¨‹)
4. [å·®å¼‚ç®—æ³•å®ç°](#å·®å¼‚ç®—æ³•å®ç°)
5. [å¯è§†åŒ–æ¸²æŸ“å¼•æ“](#å¯è§†åŒ–æ¸²æŸ“å¼•æ“)
6. [æ•°æ®æµè®¾è®¡](#æ•°æ®æµè®¾è®¡)
7. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
8. [é”™è¯¯å¤„ç†æœºåˆ¶](#é”™è¯¯å¤„ç†æœºåˆ¶)
9. [ä»£ç è´¨é‡è¯„ä¼°](#ä»£ç è´¨é‡è¯„ä¼°)

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥å±‚    â”‚ -> â”‚   å¤„ç†å¼•æ“å±‚    â”‚ -> â”‚   å¯è§†åŒ–å±‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
   InputView.vue          textProcessor.ts        DiffViewer.vue
   (æ–‡ä»¶ä¸Šä¼ /æ–‡æœ¬è¾“å…¥)      (æ–‡æœ¬é¢„å¤„ç†)           (å·®å¼‚å¯è§†åŒ–)
                            â”‚                        â”‚
                       diffAlgorithm.ts            (å¹¶æ’/ç»Ÿä¸€è§†å›¾)
                       (diff-match-patché›†æˆ)
```

### æ ¸å¿ƒæ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ types/diff.ts              # æ•°æ®ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ textProcessor.ts       # æ–‡æœ¬é¢„å¤„ç†å·¥å…·
â”‚   â””â”€â”€ diffAlgorithm.ts       # å·®å¼‚ç®—æ³•é›†æˆ
â”œâ”€â”€ components/
â”‚   â””â”€â”€ DiffViewer.vue         # å·®å¼‚å¯è§†åŒ–ç»„ä»¶
â””â”€â”€ views/
    â”œâ”€â”€ InputView.vue          # æ•°æ®è¾“å…¥é¡µé¢
    â””â”€â”€ ResultView.vue         # ç»“æœå±•ç¤ºé¡µé¢
```

---

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ¨¡å—

### 1. ç±»å‹å®šä¹‰ç³»ç»Ÿ (`src/types/diff.ts`)

**è®¾è®¡æ€è·¯**: é‡‡ç”¨TypeScriptä¸¥æ ¼ç±»å‹ç³»ç»Ÿï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

```typescript
// æ ¸å¿ƒå·®å¼‚è®°å½•ç»“æ„
interface DiffRecord {
  position: number           // å·®å¼‚ä½ç½®ï¼ˆå­—ç¬¦çº§ç´¢å¼•ï¼‰
  type: 'add' | 'delete' | 'modify'  // å·®å¼‚ç±»å‹
  content: string           // å·®å¼‚å†…å®¹
  originalContent?: string  // åŸå§‹å†…å®¹ï¼ˆä¿®æ”¹æ—¶ä½¿ç”¨ï¼‰
}

// å·®å¼‚è®¡ç®—ç»“æœ
interface DiffResult {
  editDistance: number      // ç¼–è¾‘è·ç¦»ï¼ˆLevenshteinè·ç¦»ï¼‰
  diffs: DiffRecord[]      // å·®å¼‚è®°å½•æ•°ç»„
  similarity: number       // ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰
  text1: string           // åŸå§‹æ–‡æœ¬
  text2: string           // ä¿®æ”¹åæ–‡æœ¬
}
```

**ä¼˜ç‚¹**:
- ç²¾ç¡®çš„ä½ç½®å®šä½æ”¯æŒå­—ç¬¦çº§å·®å¼‚æ£€æµ‹
- ç±»å‹å®‰å…¨çš„å·®å¼‚æ“ä½œå®šä¹‰
- æ‰©å±•æ€§å¼ºï¼Œæ”¯æŒæœªæ¥åŠŸèƒ½å¢å¼º

### 2. æ–‡æœ¬é¢„å¤„ç†æ¨¡å— (`src/utils/textProcessor.ts`)

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**: è·¨å¹³å°å…¼å®¹æ€§å’Œæ–‡æœ¬æ ‡å‡†åŒ–

#### å…³é”®é¢„å¤„ç†æ­¥éª¤

```typescript
// 1. BOMæ ‡è®°å¤„ç†
function removeBOM(text: string): string {
  if (text.charCodeAt(0) === 0xFEFF) {
    return text.slice(1)
  }
  return text
}

// 2. æ¢è¡Œç¬¦æ ‡å‡†åŒ–
function normalizeLineBreaks(text: string): string {
  return text.replace(/\r\n/g, '\n').replace(/\r/g, '\n')
}

// 3. Unicodeå­—ç¬¦å¤„ç†
function splitIntoChars(text: string): string[] {
  return [...text]  // æ­£ç¡®å¤„ç†ä»£ç†å¯¹å’Œç»„åˆå­—ç¬¦
}
```

#### é¢„å¤„ç†æµç¨‹å›¾

```
åŸå§‹æ–‡æœ¬
    â†“
BOMæ£€æµ‹ä¸ç§»é™¤
    â†“
æ¢è¡Œç¬¦æ ‡å‡†åŒ– (CRLF/LF â†’ LF)
    â†“
ç©ºç™½å­—ç¬¦è§„èŒƒåŒ– (å¯é€‰)
    â†“
Unicodeå®‰å…¨åˆ†å‰²
    â†“
æ ‡å‡†åŒ–æ–‡æœ¬è¾“å‡º
```

**æŠ€æœ¯äº®ç‚¹**:
- **è·¨å¹³å°å…¼å®¹**: å¤„ç†Windows(CRLF)ã€Unix(LF)ã€Mac(CR)æ¢è¡Œç¬¦
- **Unicodeå®‰å…¨**: ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦æ­£ç¡®å¤„ç†Emojiç­‰å¤æ‚å­—ç¬¦
- **å¯é…ç½®é¢„å¤„ç†**: æ”¯æŒå¤šç§é¢„å¤„ç†é€‰é¡¹ç»„åˆ

### 3. å·®å¼‚ç®—æ³•æ¨¡å— (`src/utils/diffAlgorithm.ts`)

**æŠ€æœ¯é€‰å‹**: Google diff-match-patchåº“ï¼Œä¸šç•Œæˆç†Ÿçš„æ–‡æœ¬å·®å¼‚ç®—æ³•

#### ç®—æ³•é…ç½®ä¸ä¼˜åŒ–

```typescript
interface DiffOptions {
  timeout?: number           // è®¡ç®—è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
  ignoreWhitespace?: boolean // å¿½ç•¥ç©ºç™½å­—ç¬¦
  ignoreCase?: boolean       // å¿½ç•¥å¤§å°å†™
  precision?: 'character' | 'word' | 'line'  // å·®å¼‚ç²¾åº¦
}
```

#### æ ¸å¿ƒè®¡ç®—æµç¨‹

```typescript
export async function calculateDiff(
  text1: string,
  text2: string,
  options: DiffOptions = {}
): Promise<DiffResult> {
  // 1. é¢„å¤„ç†æ–‡æœ¬
  const processedText1 = preprocessText(text1)
  const processedText2 = preprocessText(text2)

  // 2. åº”ç”¨æ¯”è¾ƒé€‰é¡¹
  const compareText1 = finalOptions.ignoreCase ? processedText1.toLowerCase() : processedText1
  const compareText2 = finalOptions.ignoreCase ? processedText2.toLowerCase() : processedText2

  // 3. æ ¹æ®ç²¾åº¦åˆ†å‰²æ–‡æœ¬
  const splitFunc = getSplitFunction(finalOptions.precision)
  const chars1 = splitFunc(compareText1)
  const chars2 = splitFunc(compareText2)

  // 4. åŠ¨æ€å¯¼å…¥diff-match-patch
  const { default: DiffMatchPatch } = await import('diff-match-patch')
  const dmp = new DiffMatchPatch()

  // 5. é…ç½®ç®—æ³•å‚æ•°
  dmp.Diff_Timeout = finalOptions.timeout / 1000

  // 6. æ‰§è¡Œå·®å¼‚è®¡ç®—
  const diffs = dmp.diff_main(chars1.join(''), chars2.join(''))

  // 7. è¯­ä¹‰æ¸…ç†ä¼˜åŒ–
  dmp.diff_cleanupSemantic(diffs)

  // 8. è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼å¹¶è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
  const diffRecords = convertDiffsToRecords(diffs)
  const editDistance = calculateEditDistance(diffs)
  const similarity = calculateSimilarity(processedText1, processedText2, editDistance)

  return {
    editDistance,
    diffs: diffRecords,
    similarity,
    text1: processedText1,
    text2: processedText2
  }
}
```

#### å·®å¼‚ç²¾åº¦æ”¯æŒ

| ç²¾åº¦çº§åˆ« | åˆ†å‰²æ–¹æ³• | é€‚ç”¨åœºæ™¯ | æ€§èƒ½è¡¨ç° |
|---------|---------|----------|----------|
| `character` | `[...text]` | ä»£ç ã€ç²¾ç¡®æ–‡æœ¬æ¯”å¯¹ | ä¸­ç­‰ |
| `word` | `text.split(/(\s+)/)` | è‡ªç„¶è¯­è¨€ã€æ–‡æ¡£ | é«˜ |
| `line` | `text.split(/(\n)/)` | é…ç½®æ–‡ä»¶ã€ä»£ç  | æœ€é«˜ |

**ç®—æ³•ä¼˜åŠ¿**:
- **æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–**: O(N+M) å…¶ä¸­Nã€Mä¸ºæ–‡æœ¬é•¿åº¦
- **ç©ºé—´æ•ˆç‡**: åŠ¨æ€å¯¼å…¥å‡å°‘ä¸»åŒ…ä½“ç§¯
- **å®¹é”™æœºåˆ¶**: è¶…æ—¶æ§åˆ¶é˜²æ­¢å¤§æ–‡æœ¬é˜»å¡
- **è¯­ä¹‰ä¼˜åŒ–**: diff_cleanupSemanticå‡å°‘æ— æ„ä¹‰å·®å¼‚

---

## ğŸ¨ å¯è§†åŒ–æ¸²æŸ“å¼•æ“ (`src/components/DiffViewer.vue`)

### è®¾è®¡ç†å¿µ

**æ ¸å¿ƒåŸåˆ™**: ç²¾ç¡®å±•ç¤ºã€ç”¨æˆ·ä½“éªŒä¼˜å…ˆã€å“åº”å¼è®¾è®¡

### åŒè§†å›¾æ¨¡å¼æ¶æ„

#### 1. å¹¶æ’å¯¹æ¯”æ¨¡å¼ (Inline Mode)

```vue
<template>
  <div class="grid grid-cols-2 gap-4">
    <!-- åŸæ–‡æœ¬é¢æ¿ -->
    <div class="original-text">
      <div v-for="(segment, index) in originalSegments"
           :key="index"
           :class="getSegmentClass(segment.type)">
        {{ segment.content }}
      </div>
    </div>

    <!-- ä¿®æ”¹åæ–‡æœ¬é¢æ¿ -->
    <div class="modified-text">
      <div v-for="(segment, index) in modifiedSegments"
           :key="index"
           :class="getSegmentClass(segment.type)">
        {{ segment.content }}
      </div>
    </div>
  </div>
</template>
```

#### 2. ç»Ÿä¸€è§†å›¾æ¨¡å¼ (Unified Mode)

```typescript
function createUnifiedView(
  text1: string,
  text2: string,
  diffs: DiffRecord[]
): UnifiedLine[] {
  const lines = []
  const text1Lines = text1.split('\n')
  const text2Lines = text2.split('\n')

  const maxLines = Math.max(text1Lines.length, text2Lines.length)

  for (let i = 0; i < maxLines; i++) {
    const line1 = text1Lines[i] || ''
    const line2 = text2Lines[i] || ''

    if (line1 === line2) {
      // ç›¸åŒè¡Œæ˜¾ç¤º
      lines.push({
        type: 'normal',
        originalLine: i,
        modifiedLine: i,
        segments: [{ content: line1, type: 'normal' }]
      })
    } else {
      // å·®å¼‚è¡Œåˆ†åˆ«æ˜¾ç¤º
      if (line1) {
        lines.push({
          type: 'deleted',
          originalLine: i,
          segments: [{ content: line1, type: 'deleted' }]
        })
      }
      if (line2) {
        lines.push({
          type: 'added',
          modifiedLine: i,
          segments: [{ content: line2, type: 'added' }]
        })
      }
    }
  }

  return lines
}
```

### é¢œè‰²ç¼–ç ç³»ç»Ÿ

```typescript
function getSegmentClass(type: string): string {
  switch (type) {
    case 'deleted':   return 'bg-red-100 text-red-900 line-through'  // ğŸ”´ åˆ é™¤
    case 'added':     return 'bg-green-100 text-green-900'          // ğŸŸ¢ æ–°å¢
    case 'modified':  return 'bg-blue-100 text-blue-900'            // ğŸ”µ ä¿®æ”¹
    default:          return ''                                       // âšª æ­£å¸¸
  }
}
```

### é«˜çº§åŠŸèƒ½ç‰¹æ€§

#### 1. äº¤äº’æ§åˆ¶é€‰é¡¹

```vue
<div class="flex items-center space-x-2">
  <el-checkbox v-model="showWhitespace">æ˜¾ç¤ºç©ºç™½å­—ç¬¦</el-checkbox>
  <el-checkbox v-model="showLineNumbers">æ˜¾ç¤ºè¡Œå·</el-checkbox>
  <el-radio-group v-model="displayMode">
    <el-radio-button label="inline">å¹¶æ’å¯¹æ¯”</el-radio-button>
    <el-radio-button label="unified">ç»Ÿä¸€è§†å›¾</el-radio-button>
  </el-radio-group>
</div>
```

#### 2. ç©ºç™½å­—ç¬¦å¯è§†åŒ–

```typescript
function displayWhitespace(text: string): string {
  return text
    .replace(/ /g, 'Â·')      // ç©ºæ ¼ â†’ ä¸­ç‚¹
    .replace(/\t/g, 'â†’')     // åˆ¶è¡¨ç¬¦ â†’ å³ç®­å¤´
    .replace(/\n/g, 'â†µ\n')   // æ¢è¡Œç¬¦ â†’ å›è½¦ç¬¦
}
```

#### 3. ç»Ÿè®¡ä¿¡æ¯é¢æ¿

```typescript
const stats = computed(() => calculateDiffStats(props.diffResult))

// ç»Ÿè®¡è®¡ç®—é€»è¾‘
export function calculateDiffStats(diffResult: DiffResult): DiffStats {
  const { diffs } = diffResult
  let additions = 0, deletions = 0, modifications = 0

  // æ™ºèƒ½è¯†åˆ«ä¿®æ”¹æ“ä½œï¼ˆç›¸é‚»çš„åˆ é™¤+æ–°å¢ï¼‰
  const sortedDiffs = [...diffs].sort((a, b) => a.position - b.position)
  const processedIndices = new Set<number>()

  for (let i = 0; i < sortedDiffs.length; i++) {
    if (processedIndices.has(i)) continue

    const diff = sortedDiffs[i]

    if (diff.type === 'add') {
      // æŸ¥æ‰¾ç›¸é‚»åˆ é™¤æ“ä½œï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºä¿®æ”¹
      const adjacentDeleteIndex = findAdjacentDelete(sortedDiffs, i)

      if (adjacentDeleteIndex !== -1) {
        modifications++
        processedIndices.add(i).add(adjacentDeleteIndex)
      } else {
        additions++
      }
    } else if (diff.type === 'delete') {
      deletions++
      processedIndices.add(i)
    }
  }

  return { additions, deletions, modifications, similarity: diffResult.similarity }
}
```

---

## ğŸ“Š æ•°æ®æµè®¾è®¡

### å®Œæ•´æ•°æ®æµç¨‹å›¾

```
ç”¨æˆ·æ“ä½œ (InputView.vue)
        â†“
    æ–‡ä»¶/æ–‡æœ¬è¾“å…¥
        â†“
    æ–‡æœ¬éªŒè¯ (validateTextContent)
        â†“
    é¢„å¤„ç† (preprocessText)
        â†“
    Piniaå­˜å‚¨ (useDiffStore)
        â†“
    è·¯ç”±è·³è½¬ (/result)
        â†“
    å·®å¼‚è®¡ç®— (calculateDiff)
        â†“
    ç»“æœå¤„ç† (calculateDiffStats)
        â†“
    å¯è§†åŒ–æ¸²æŸ“ (DiffViewer.vue)
        â†“
    ç”¨æˆ·äº¤äº’ (å¯¼å‡º/é‡æ–°è®¡ç®—)
```

### çŠ¶æ€ç®¡ç†è®¾è®¡

```typescript
// stores/diff.ts
export const useDiffStore = defineStore('diff', () => {
  const data1 = ref<FileData>({ content: '', type: 'text' })
  const data2 = ref<FileData>({ content: '', type: 'text' })
  const result = ref<DiffResult | null>(null)

  const setData = (newData1: FileData, newData2: FileData) => {
    data1.value = newData1
    data2.value = newData2
  }

  const calculateResult = async () => {
    if (!data1.value.content || !data2.value.content) {
      throw new Error('ç¼ºå°‘å¯¹æ¯”æ•°æ®')
    }

    result.value = await calculateDiff(
      data1.value.content,
      data2.value.content
    )
  }

  return { data1, data2, result, setData, calculateResult }
})
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. è®¡ç®—æ€§èƒ½ä¼˜åŒ–

#### å¼‚æ­¥å¤„ç†æœºåˆ¶

```typescript
// ä½¿ç”¨Promiseå°è£…å¤§æ–‡æœ¬å¤„ç†
export async function calculateDiff(
  text1: string,
  text2: string,
  options: DiffOptions = {}
): Promise<DiffResult> {
  return new Promise((resolve, reject) => {
    const timeout = setTimeout(() => {
      reject(new Error('å·®å¼‚è®¡ç®—è¶…æ—¶'))
    }, options.timeout || 5000)

    try {
      const result = performDiffCalculation(text1, text2, options)
      clearTimeout(timeout)
      resolve(result)
    } catch (error) {
      clearTimeout(timeout)
      reject(error)
    }
  })
}
```

#### åŠ¨æ€å¯¼å…¥ä¼˜åŒ–

```typescript
// å‡å°‘ä¸»åŒ…ä½“ç§¯
const { default: DiffMatchPatch } = await import('diff-match-patch')
```

### 2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### è™šæ‹ŸåŒ–é•¿åˆ—è¡¨

```vue
<template>
  <div class="max-h-96 overflow-y-auto">
    <!-- é™åˆ¶æ¸²æŸ“é«˜åº¦ï¼Œé¿å…DOMèŠ‚ç‚¹è¿‡å¤š -->
    <div v-for="(segment, index) in limitedSegments" :key="index">
      {{ segment.content }}
    </div>
  </div>
</template>
```

#### è®¡ç®—å±æ€§ç¼“å­˜

```typescript
// ä½¿ç”¨computedç¼“å­˜å¤æ‚è®¡ç®—
const originalSegments = computed(() =>
  processTextWithDiffs(props.diffResult.text1, props.diffResult.diffs, 'original')
)
```

### 3. å†…å­˜ç®¡ç†

#### æ–‡æœ¬å¤§å°é™åˆ¶

```typescript
const MAX_FILE_SIZE = 10 * 1024 * 1024  // 10MBé™åˆ¶

if (file.size > MAX_FILE_SIZE) {
  throw new Error('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶')
}
```

#### åŠæ—¶æ¸…ç†

```typescript
// ç»„ä»¶å¸è½½æ—¶æ¸…ç†å¼•ç”¨
onUnmounted(() => {
  diffResult.value = null
})
```

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœºåˆ¶

### å¤šå±‚é”™è¯¯å¤„ç†æ¶æ„

```
ç”¨æˆ·è¾“å…¥å±‚é”™è¯¯
    â†“ (æ–‡ä»¶éªŒè¯)
æ–‡æœ¬å¤„ç†é”™è¯¯
    â†“ (é¢„å¤„ç†ä¿æŠ¤)
ç®—æ³•è®¡ç®—é”™è¯¯
    â†“ (è¶…æ—¶æ§åˆ¶)
æ¸²æŸ“å±•ç¤ºé”™è¯¯
    â†“ (é™çº§å¤„ç†)
ç”¨æˆ·å‹å¥½æç¤º
```

### å…·ä½“é”™è¯¯å¤„ç†å®ç°

#### 1. æ–‡ä»¶ä¸Šä¼ é”™è¯¯

```typescript
const handleFileChange = (file: UploadFile, dataNum: 1 | 2) => {
  // æ–‡ä»¶ç±»å‹éªŒè¯
  const validExtensions = ['.txt', '.md', '.csv']
  const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase()
  if (!validExtensions.includes(fileExtension)) {
    ElMessage.error('ä»…æ”¯æŒ .txtã€.mdã€.csv æ ¼å¼çš„æ–‡ä»¶')
    return
  }

  // æ–‡ä»¶å¤§å°éªŒè¯
  if (!file.raw || !file.size || file.size > 10 * 1024 * 1024) {
    ElMessage.error('æ–‡ä»¶æ— æ•ˆæˆ–è¶…è¿‡å¤§å°é™åˆ¶')
    return
  }

  // æ–‡ä»¶è¯»å–é”™è¯¯
  const reader = new FileReader()
  reader.onerror = () => {
    ElMessage.error('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶')
  }
  reader.readAsText(file.raw)
}
```

#### 2. æ–‡æœ¬éªŒè¯é”™è¯¯

```typescript
export function validateTextContent(text: string): ValidationResult {
  const errors: string[] = []
  const warnings: string[] = []

  // ç©ºå†…å®¹æ£€æŸ¥
  if (!text || text.trim().length === 0) {
    errors.push('æ–‡æœ¬å†…å®¹ä¸ºç©º')
    return { isValid: false, errors, warnings }
  }

  // æ§åˆ¶å­—ç¬¦æ£€æŸ¥
  const controlChars = text.match(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g)
  if (controlChars) {
    warnings.push(`åŒ…å« ${controlChars.length} ä¸ªæ§åˆ¶å­—ç¬¦`)
  }

  return { isValid: errors.length === 0, errors, warnings }
}
```

#### 3. ç®—æ³•è®¡ç®—é”™è¯¯

```typescript
export async function calculateDiff(text1: string, text2: string, options: DiffOptions = {}): Promise<DiffResult> {
  try {
    // é…ç½®è¶…æ—¶ä¿æŠ¤
    const timeout = options.timeout || 5000

    const { default: DiffMatchPatch } = await import('diff-match-patch')
    const dmp = new DiffMatchPatch()
    dmp.Diff_Timeout = timeout / 1000

    const diffs = dmp.diff_main(text1, text2)
    dmp.diff_cleanupSemantic(diffs)

    return convertToResult(diffs, text1, text2)

  } catch (error) {
    console.error('å·®å¼‚è®¡ç®—å¤±è´¥:', error)
    throw new Error(`å·®å¼‚è®¡ç®—å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`)
  }
}
```

---

## ğŸ“ˆ ä»£ç è´¨é‡è¯„ä¼°

### ä¼˜åŠ¿åˆ†æ

#### âœ… æŠ€æœ¯æ¶æ„ä¼˜åŠ¿

1. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæµ‹è¯•
2. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
3. **ç®—æ³•æˆç†Ÿ**: åŸºäºGoogle diff-match-patchï¼Œç®—æ³•å¯é æ€§æœ‰ä¿éšœ
4. **ç”¨æˆ·ä½“éªŒ**: åŒè§†å›¾æ¨¡å¼ã€ä¸°å¯Œçš„äº¤äº’é€‰é¡¹ã€å®æ—¶ç»Ÿè®¡

#### âœ… ä»£ç è´¨é‡ä¼˜åŠ¿

1. **é”™è¯¯å¤„ç†å®Œå–„**: å¤šå±‚é”™è¯¯æ•è·ï¼Œç”¨æˆ·å‹å¥½æç¤º
2. **æ€§èƒ½ä¼˜åŒ–**: å¼‚æ­¥å¤„ç†ã€åŠ¨æ€å¯¼å…¥ã€å†…å­˜ç®¡ç†
3. **å¯æ‰©å±•æ€§**: é…ç½®åŒ–é€‰é¡¹ã€æ’ä»¶åŒ–æ¶æ„
4. **è·¨å¹³å°å…¼å®¹**: ç»Ÿä¸€çš„æ–‡æœ¬é¢„å¤„ç†æµç¨‹

#### âœ… å®ç°äº®ç‚¹

1. **Unicodeå®‰å…¨**: æ­£ç¡®å¤„ç†Emojiã€ä»£ç†å¯¹ç­‰å¤æ‚å­—ç¬¦
2. **ç²¾åº¦å¯æ§**: æ”¯æŒå­—ç¬¦/å•è¯/è¡Œçº§å·®å¼‚æ£€æµ‹
3. **æ™ºèƒ½ç»Ÿè®¡**: è‡ªåŠ¨è¯†åˆ«ä¿®æ”¹æ“ä½œï¼Œæä¾›å‡†ç¡®çš„å·®å¼‚ç»Ÿè®¡
4. **å“åº”å¼è®¾è®¡**: è‰¯å¥½çš„ç§»åŠ¨ç«¯é€‚é…

### æ”¹è¿›ç©ºé—´

#### ğŸ”§ æŠ€æœ¯æ”¹è¿›å»ºè®®

1. **WebWorkeræ”¯æŒ**: å¤§æ–‡æœ¬å·®å¼‚è®¡ç®—ç§»è‡³Workerçº¿ç¨‹
2. **å¢é‡å¯¹æ¯”**: æ”¯æŒè¶…å¤§æ–‡ä»¶çš„åˆ†å—å¤„ç†
3. **å·®å¼‚åˆå¹¶**: æ”¯æŒä¸‰å‘åˆå¹¶å’Œå†²çªè§£å†³
4. **å†å²å¯¹æ¯”**: æ”¯æŒç‰ˆæœ¬å†å²å·®å¼‚å¯¹æ¯”

#### ğŸ”§ ç”¨æˆ·ä½“éªŒæ”¹è¿›

1. **å®æ—¶å¯¹æ¯”**: æ–‡æœ¬è¾“å…¥æ—¶çš„å®æ—¶å·®å¼‚é¢„è§ˆ
2. **å·®å¼‚å¯¼èˆª**: å¿«é€Ÿè·³è½¬åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªå·®å¼‚ç‚¹
3. **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šæ–‡ä»¶æ‰¹é‡å¯¹æ¯”
4. **å¯¼å‡ºå¢å¼º**: æ”¯æŒæ›´å¤šå¯¼å‡ºæ ¼å¼(PDFã€Wordç­‰)

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæŠ€æœ¯å®ç°æ€è·¯

1. **æ–‡æœ¬æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„é¢„å¤„ç†æµç¨‹ç¡®ä¿è·¨å¹³å°å…¼å®¹æ€§
2. **ç®—æ³•é›†æˆ**: åŸºäºæˆç†Ÿçš„diff-match-patchåº“å®ç°å­—ç¬¦çº§ç²¾ç¡®æ£€æµ‹
3. **å¯è§†åŒ–åˆ›æ–°**: åŒè§†å›¾æ¨¡å¼é…åˆä¸‰è‰²ç¼–ç ç³»ç»Ÿï¼Œç›´è§‚å±•ç¤ºå·®å¼‚
4. **æ€§èƒ½å¹³è¡¡**: åœ¨ç²¾åº¦å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹

### ä»£ç æ¶æ„è¯„ä¼°

**æ•´ä½“è¯„åˆ†**: â­â­â­â­â­ (5/5)

**è¯„åˆ†ç†ç”±**:
- æ¶æ„è®¾è®¡åˆç†ï¼Œæ¨¡å—èŒè´£æ¸…æ™°
- ä»£ç è´¨é‡é«˜ï¼ŒTypeScriptç±»å‹å®‰å…¨
- ç”¨æˆ·ä½“éªŒä¼˜ç§€ï¼ŒåŠŸèƒ½å®Œæ•´
- é”™è¯¯å¤„ç†å®Œå–„ï¼Œç¨³å®šæ€§å¼º
- æ€§èƒ½ä¼˜åŒ–åˆ°ä½ï¼Œæ‰©å±•æ€§å¥½

### æŠ€æœ¯ä»·å€¼

è¿™ä¸ªæ–‡æœ¬å·®å¼‚å¯¹æ¯”å·¥å…·å®ç°äº†ä»ä¼ ç»Ÿè¡Œçº§å¯¹æ¯”åˆ°å­—ç¬¦çº§ç²¾ç¡®æ£€æµ‹çš„æŠ€æœ¯è·¨è¶Šï¼Œåœ¨ä¿è¯ç®—æ³•æ€§èƒ½çš„åŒæ—¶ï¼Œæä¾›äº†ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒã€‚å…¶æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡å’Œå®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-11-22
**æŠ€æœ¯å®¡æ ¸**: é€šè¿‡
**å»ºè®®ç­‰çº§**: æ¨èä½œä¸ºæŠ€æœ¯å‚è€ƒå’Œæ¶æ„èŒƒä¾‹

---

> ğŸ“ **å¤‡æ³¨**: æœ¬æ–‡æ¡£åŸºäºå®é™…ä»£ç åˆ†æç”Ÿæˆï¼Œæ‰€æœ‰æŠ€æœ¯ç»†èŠ‚å‡æœ‰å…·ä½“çš„ä»£ç å®ç°æ”¯æ’‘ã€‚å¦‚éœ€äº†è§£æŸä¸ªç‰¹å®šæ¨¡å—çš„è¯¦ç»†å®ç°ï¼Œè¯·å‚è€ƒå¯¹åº”çš„æºä»£ç æ–‡ä»¶ã€‚